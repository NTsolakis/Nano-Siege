:root{
  --bg: #0a0f14;
  --panel: #0e1620;
  --grid: #14202a;
  --accent: #17e7a4;
  --accent-2: #00baff;
  --text: #d5e8ff;
  --muted: #8aa7c7;
  --danger: #ff5370;
  --design-width: 1600;
  --canvas-zoom: 1;
}

*{box-sizing:border-box}
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  /* Ensure the body spans the full viewport so the background
   * image covers the whole screen on all aspect ratios without
   * needing background-attachment:fixed (which can cause scroll
   * issues on some devices). */
  min-height:100vh;
  background:#020713 url('data/loading-bg.gif') center center/cover no-repeat;
  font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  color:var(--text);
}

#scale-root{
  position:fixed;
  top:0;
  left:0;
  width:100vw;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  overflow:hidden;
  pointer-events:auto;
  z-index:1;
}
#game-frame{
  position:absolute;
  top:0;
  left:50%;
  width:1600px;
  height:3600px;
  transform-origin:top center;
  pointer-events:auto;
  visibility:visible;
}
#game-container{
  position:fixed;
  top:0;
  left:0;
  width:100vw;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  overflow:hidden;
  pointer-events:auto;
  z-index:1;
}
/* When fullscreen menus are visible, fade out the in-game board/HUD
 * so the global neon background shows cleanly behind the menus. */
body.mainmenu-visible #game-container{
  opacity:0;
  pointer-events:none;
}

#game-root{
  position:relative;
  width:1600px;
  height:900px;
}
#game-wrapper,
#app{
  position:absolute;
  top:0;
  left:0;
  width:1600px;
  height:900px;
  transform-origin:top left;
  display:flex;
  flex-direction:column;
}
.signin-banner{
  position:fixed;
  left:24px;
  bottom:18px;
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px 18px;
  border-radius:16px;
  background:rgba(6,12,20,.9);
  border:1px solid rgba(0,186,255,.25);
  color:#b9f5ff;
  font-size:13px;
  box-shadow:0 16px 40px rgba(0,0,0,.55),0 0 18px rgba(0,186,255,.2);
  z-index:800;
}
/* Ensure the signed-in banner remains fully visible above the main
 * menu panels on the title screen without affecting in-run overlays. */
body.mainmenu-visible .signin-banner{
  z-index:120000;
}
.signin-banner .label{
  font-size:11px;
  letter-spacing:.35em;
  text-transform:uppercase;
  color:#7cdcff;
}
.signin-banner .name{
  font-size:15px;
  font-weight:600;
  letter-spacing:.2em;
  color:#fff;
}

.stats{display:flex;gap:16px;color:var(--muted)}
.stats span{padding:2px 8px;border-radius:6px;background:var(--panel);border:1px solid rgba(255,255,255,.08)}
/* HP stat overrides */
.stats .hpstat{display:flex;flex-direction:column;gap:6px;padding:0;background:transparent;border:none}
.hpbar{display:block;width:140px;height:6px;background:rgba(255,255,255,.12);border-radius:6px;overflow:hidden;box-shadow:inset 0 0 0 1px rgba(255,255,255,.06)}
.hpbar .hpfill{display:block;height:100%;width:100%;background:linear-gradient(90deg, var(--accent), var(--accent-2));box-shadow:0 0 10px rgba(0,186,255,.45) inset;transition: width .25s ease, background .25s ease, background-color .25s ease, box-shadow .25s ease}
.hpbar .hpfill.low{background:linear-gradient(90deg, var(--danger), #ff8a9a);box-shadow:0 0 10px rgba(255,83,112,.45) inset}

.toolbar{display:flex;align-items:center;gap:12px}
button{appearance:none;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,rgba(0,186,255,.2),rgba(23,231,164,.08));color:var(--text);padding:8px 16px;border-radius:10px;cursor:pointer;min-height:42px;font-weight:600;letter-spacing:.04em}
button:hover{border-color:var(--accent)}
button:active{transform:translateY(1px)}
button:disabled{opacity:.55;cursor:not-allowed;filter:grayscale(40%)}

/* Toggle switch */
.switch{position:relative;display:inline-block;width:44px;height:24px}
.switch input{opacity:0;width:0;height:0}
.switch .slider{position:absolute;inset:0;border-radius:999px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.18);transition:all .2s}
.switch .slider:before{content:"";position:absolute;left:3px;top:50%;transform:translateY(-50%);width:18px;height:18px;border-radius:50%;background:#94a3b8;box-shadow:0 2px 6px rgba(0,0,0,.3);transition:all .2s}
.switch input:checked + .slider{background:linear-gradient(180deg,rgba(0,186,255,.25),rgba(23,231,164,.12));border-color:var(--accent-2)}
.switch input:checked + .slider:before{left:23px;background:var(--accent-2)}

.dev-toggle{margin-top:10px; display:flex; align-items:center; justify-content:center; gap:10px; color:#8aa7c7; font-size:13px}
.dev-toggle .dev-label{color:var(--text)}
.dev-toggle .dev-hint{color:#8aa7c7; font-size:12px}
.sandbox-btn{margin-top:6px;padding:4px 10px;font-size:11px;letter-spacing:.14em;text-transform:uppercase;border-radius:999px}

/* Wave status pill */
.wave-status{display:inline-flex;flex-direction:column;align-items:flex-start;gap:4px;padding:6px 10px;border-radius:12px;background:var(--panel);border:1px solid rgba(255,255,255,.08);color:var(--muted);font-size:12px}
.wave-status.inactive{opacity:.55}
.wave-status.inactive .ws-label::before{animation:none;opacity:.5}
/* pulsing dot sits before the label */
.wave-status .ws-label{display:inline-flex;align-items:center;gap:8px}
.wave-status .ws-label::before{content:"";display:inline-block;width:7px;height:7px;border-radius:50%;background:var(--accent-2);box-shadow:0 0 10px rgba(0,186,255,.7);animation:wsPulse 1.2s ease-in-out infinite}
@keyframes wsPulse{0%{transform:scale(.9);opacity:.6}50%{transform:scale(1.25);opacity:1}100%{transform:scale(.9);opacity:.6}}

.wave-status .wave-bar{position:relative;display:block;width:160px;max-width:22vw;height:4px;background:rgba(255,255,255,.12);border-radius:999px;overflow:hidden;box-shadow:inset 0 0 0 1px rgba(255,255,255,.06)}
.wave-status .wave-bar .fill{display:block;height:100%;width:100%;background:linear-gradient(90deg, var(--accent-2), var(--accent));box-shadow:0 0 6px rgba(0,186,255,.45) inset;transition:width .25s ease}

.tower-palette{
  display:flex;
  gap:5px;
  color:var(--muted);
  background:rgba(0,0,0,.35);
  padding:6px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.08);
  width:100%;
}
.tower-palette .tower-btn{
  border:1px solid rgba(255,255,255,.12);
  background:rgba(4,8,14,.9);
  color:var(--muted);
  padding:6px 10px 8px;
  border-radius:11px;
  cursor:pointer;
  font-weight:600;
  letter-spacing:.05em;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:4px;
  min-height:70px;
  flex:1 1 0;
  min-width:0;
  white-space:nowrap;
  position:relative;
  overflow:hidden;
  box-shadow:0 10px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.02);
}
.tower-palette .tower-btn:hover{border-color:var(--accent-2);color:var(--text);box-shadow:0 0 20px rgba(0,186,255,.25)}
.tower-palette .tower-btn.selected{color:var(--text);border-color:var(--accent);background:linear-gradient(180deg,rgba(0,186,255,.25),rgba(23,231,164,.08));box-shadow:0 0 0 1px rgba(23,231,164,.25) inset,0 0 20px rgba(23,231,164,.25)}

.tower-palette .tower-label{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:2px;
  font-size:12px;
}
.tower-palette .tower-name{
  text-transform:none;
}
.tower-palette .tower-cost{
  font-size:11px;
  color:var(--muted);
}
.tower-icon{
  position:relative;
  width:40px;
  height:30px;
  margin-bottom:2px;
  background-repeat:no-repeat;
  background-position:center;
  background-size:contain;
}
.tower-icon::before,
.tower-icon::after{
  content:none;
}
/* Use the new tower sprites as button icons.
 * Mapping: basic -> cannon, laser -> laser, splash -> splash.
 */
.tower-icon-basic{
  background-image:url('data/tower-cannon.png');
}
.tower-icon-laser{
  background-image:url('data/tower-laser.png');
}
.tower-icon-splash{
  background-image:url('data/tower-splash.png');
}

canvas#game{display:block;max-width:100%;width:960px;height:auto;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:linear-gradient(180deg,rgba(0,0,0,.2),rgba(0,0,0,.3));box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.04)}

/* Overlays */
.overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;padding:24px}
.overlay.visible{display:flex;z-index:2000;}
.overlay .panel{background:var(--panel);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:24px 32px;box-shadow:0 20px 60px rgba(0,0,0,.6), inset 0 0 0 1px rgba(255,255,255,.06);text-align:center;max-width:560px;width:100%}
#shop-overlay .panel{max-width:720px}
.overlay .panel.small{max-width:520px}
.overlay h2,.overlay h3{margin:0 0 8px;color:var(--accent-2);letter-spacing:.5px}
.overlay .tag{margin:0 0 16px;color:var(--muted)}
.overlay .actions{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:8px 0 8px}
.overlay .hint{margin:8px 0 0;color:var(--muted);font-size:12px;opacity:.8}

/* Ensure the exit-confirm overlay appears above fullscreen main menu
 * and gameplay, so the confirmation dialog is always visible no matter
 * where it is triggered from (browser or desktop builds). */
#exitconfirm-overlay{
  position:fixed;
  inset:0;
  z-index:120000;
}

/* Initial fullscreen loading screen */
.loading-overlay{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
  background:rgba(3,7,20,.6);
  z-index:100000;
  transition:opacity .35s ease, visibility .35s ease;
}
.loading-overlay.hidden{
  opacity:0;
  visibility:hidden;
}
.loading-panel{
  background:rgba(3,7,18,.82);
  border-radius:20px;
  padding:24px 32px;
  border:1px solid rgba(0,186,255,.3);
  box-shadow:0 26px 80px rgba(0,0,0,.85),0 0 40px rgba(0,186,255,.4),inset 0 0 0 1px rgba(255,255,255,.05);
  text-align:center;
  max-width:420px;
  width:100%;
  backdrop-filter:blur(10px);
}
.loading-title{
  font-size:22px;
  letter-spacing:.35em;
  text-transform:uppercase;
  color:#a7f5ff;
  margin-bottom:6px;
}
.loading-sub{
  font-size:13px;
  color:#8aa7c7;
  margin-bottom:16px;
}
.loading-bar{
  position:relative;
  width:100%;
  height:6px;
  border-radius:999px;
  background:rgba(0,0,0,.55);
  overflow:hidden;
}
.loading-bar .fill{
  position:absolute;
  inset:0;
  width:10%;
  border-radius:inherit;
  background:linear-gradient(90deg,#17e7a4,#00baff,#81f5ff);
  box-shadow:0 0 18px rgba(0,186,255,.7);
  transition:width .18s ease-out;
}

/* While the loading overlay is visible, hide the in-game frame and
 * fullscreen main menu so only the loading card + global background
 * are visible. */
#loading-overlay:not(.hidden) + #game-container{
  opacity:0;
  pointer-events:none;
}
#loading-overlay:not(.hidden) ~ #mainmenu-overlay{
  opacity:0;
  pointer-events:none;
}

/* Fullscreen main menu */
.overlay.mainmenu{
  position:fixed;
  inset:0;
  min-height:100vh;
  padding:40px 16px 32px;
  background:rgba(3,7,20,.65);
  overflow:auto;
  z-index:900;
}
.overlay.mainmenu::before{content:\"\";position:absolute;inset:-25%;background:conic-gradient(from 0deg,#00baff22,#00ffa02a,#0062ff22,#00ffa02a,#00baff22);filter:blur(60px);opacity:.7;animation:menuFlow 18s linear infinite}
.overlay.mainmenu::after{content:\"\";position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.03) 1px,transparent 1px);background-size:120px 120px;opacity:.15;mix-blend-mode:screen;animation:gridPulse 6s ease-in-out infinite}
.overlay.mainmenu > *{position:relative;z-index:1}
#mainmenu-overlay{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  max-height:100vh;
  overflow:hidden;
  z-index:99999;
  pointer-events:auto;
}
#mainmenu-overlay.visible{display:flex;}
#mainmenu-overlay .mainmenu-panel{max-width:640px;padding:40px 52px;border-radius:24px;background:rgba(8,12,20,.92);box-shadow:0 30px 120px rgba(0,0,0,.85),0 0 35px rgba(0,186,255,.3),inset 0 0 0 1px rgba(255,255,255,.04)}
#assembly-overlay{
  align-items:flex-start;
  padding:48px 16px 96px;
  overflow:auto;
}
#assembly-overlay .mainmenu-panel{
  max-width:1080px;
  width:100%;
}
.mainmenu-logo-wrap{position:relative;display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:36px;text-align:center}
.mainmenu-orbit{position:absolute;width:220px;height:220px;border-radius:50%;border:1px solid rgba(0,186,255,.4);box-shadow:0 0 30px rgba(0,186,255,.35),0 0 60px rgba(23,231,164,.25);animation:orbitSpin 16s linear infinite;opacity:.8}
.mainmenu-logo{margin:0;font-size:clamp(42px,4vw + 12px,84px);letter-spacing:.2em;text-transform:uppercase;background:linear-gradient(120deg,#17e7a4,#00baff,#81f5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 0 25px rgba(0,186,255,.65),0 0 55px rgba(23,231,164,.55);animation:neonPulse 3.5s ease-in-out infinite}
.mainmenu-sub{margin:0;color:#a5ffdd;letter-spacing:.25em;font-size:13px;text-transform:uppercase;opacity:.85}
.mainmenu-actions{
  display:flex;
  flex-direction:column;
  gap:14px;
  width:100%;
}
.mainmenu-actions button{height:56px;font-size:15px;letter-spacing:.08em;text-transform:uppercase;font-weight:600;border-radius:999px;box-shadow:0 10px 30px rgba(0,0,0,.45);background:linear-gradient(120deg,rgba(0,186,255,.25),rgba(23,231,164,.18));border:1px solid rgba(0,186,255,.35);position:relative}
.mainmenu-actions button:hover{box-shadow:0 10px 40px rgba(0,186,255,.45);border-color:var(--accent);color:#fff}
.badge-uc{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:3px 8px;margin-left:8px;border-radius:999px;background:rgba(255,138,154,0.18);border:1px solid rgba(255,83,112,0.35);color:#ffd6e0;font-size:11px;letter-spacing:.1em;text-transform:uppercase;box-shadow:0 6px 14px rgba(255,83,112,.25)}

#mainsettings-overlay .mainmenu-panel,
#loadmenu-overlay .mainmenu-panel,
#create-overlay .mainmenu-panel,
#leaderboard-overlay .mainmenu-panel,
#profile-overlay .mainmenu-panel{
  max-width:560px;
  padding:34px 40px;
  border-radius:24px;
  background:rgba(5,10,18,.94);
  border:1px solid rgba(0,186,255,.18);
  box-shadow:0 25px 80px rgba(0,0,0,.75),0 0 22px rgba(0,186,255,.2),inset 0 0 0 1px rgba(255,255,255,.03);
  position:relative;
  overflow:hidden;
}
#mainsettings-overlay .mainmenu-panel::before,
#loadmenu-overlay .mainmenu-panel::before,
#create-overlay .mainmenu-panel::before,
#leaderboard-overlay .mainmenu-panel::before,
#profile-overlay .mainmenu-panel::before{
  content:\"\";position:absolute;inset:8px;border-radius:inherit;border:1px solid rgba(255,255,255,.05);opacity:.7;pointer-events:none;
}

/* How To Play layout */
#howto-overlay .mainmenu-panel{
  max-width:960px;
}
.howto-body{
  margin-top:8px;
  display:flex;
  flex-direction:column;
  gap:16px;
  max-height:60vh;
  overflow:auto;
}
.howto-section h3{
  margin:0 0 4px;
  font-size:14px;
  letter-spacing:.24em;
  text-transform:uppercase;
  color:#a7f5ff;
}
.howto-section p{
  margin:0 0 6px;
  font-size:13px;
  color:#c2e2ff;
}
.howto-section ul{
  margin:0 0 6px 1.2em;
  padding:0;
  font-size:13px;
  color:#9fb9dd;
}
.howto-bullets-tight li{
  margin-bottom:2px;
}
.howto-tower-list li,
.howto-pilot-list li{
  margin-bottom:4px;
}
.howto-pill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:2px 8px;
  border-radius:999px;
  font-size:11px;
  letter-spacing:.12em;
  text-transform:uppercase;
  margin-right:4px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(4,10,18,.9);
}
.howto-pill.cannon{
  border-color:rgba(23,231,164,.6);
  color:#a8ffde;
}
.howto-pill.laser{
  border-color:rgba(0,186,255,.7);
  color:#b5f2ff;
}
.howto-pill.splash{
  border-color:rgba(255,158,0,.7);
  color:#ffe2b3;
}

/* Bug Reports & Suggestions layout */
#bug-overlay .mainmenu-panel{
  max-width:640px;
}
.bug-form label{
  display:block;
  margin:10px 0 4px;
  font-size:13px;
  color:#c3cbd4;
}
.bug-form select,
.bug-form textarea,
.bug-form input[type="email"]{
  width:100%;
  padding:8px 10px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.12);
  background:rgba(4,10,18,0.96);
  color:#d7e1e8;
  font-size:13px;
  resize:vertical;
}
.bug-form select:focus,
.bug-form textarea:focus,
.bug-form input[type="email"]:focus{
  outline:none;
  border-color:var(--accent-2);
  box-shadow:0 0 0 1px rgba(0,186,255,0.5);
}
.bug-status{
  min-height:18px;
  margin-top:8px;
  font-size:12px;
  color:#8aa7c7;
}
.bug-footer{
  margin-top:10px;
  font-size:12px;
  color:#737982;
  text-align:center;
}
.mainmenu-panel h2{margin-bottom:6px;color:#b8f9ff;letter-spacing:.35em;text-transform:uppercase;text-align:center}
.mainmenu-panel .tag{color:#8aa7c7;letter-spacing:.2em;text-transform:uppercase;font-size:12px;margin-bottom:18px}
.sandbox-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-top:10px}
.sandbox-card{border-radius:16px;padding:14px 14px 12px;background:rgba(4,10,18,.9);border:1px solid rgba(0,186,255,.22);box-shadow:0 10px 40px rgba(0,0,0,.6),0 0 22px rgba(0,186,255,.18);text-align:left}
.sandbox-card h3{margin:0 0 10px;font-size:14px;letter-spacing:.18em;text-transform:uppercase;color:#a7f5ff}
.sb-field{display:grid;grid-template-columns:1.4fr 2fr auto;align-items:center;gap:8px;margin-bottom:8px;font-size:12px;color:#a5d3ff}
.sb-field label{font-size:11px;letter-spacing:.16em;text-transform:uppercase;color:#8ab6de}
.sb-field input[type=range]{width:100%}
.sb-value{min-width:44px;text-align:right;color:#e5f4ff;font-variant-numeric:tabular-nums}
.sb-toggle{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px;font-size:12px;color:#a5d3ff}
.sb-toggle label:first-child{letter-spacing:.16em;text-transform:uppercase;font-size:11px;color:#8ab6de}
.login-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;width:100%}
.login-field{display:flex;flex-direction:column;gap:4px;font-size:13px;color:#a5d3ff}
.login-field label{letter-spacing:.15em;text-transform:uppercase;font-size:11px;color:#8ab6de}
.login-field input{border:1px solid rgba(0,186,255,.3);border-radius:12px;background:rgba(255,255,255,.04);color:var(--text);padding:10px 12px;font-size:14px;box-shadow:inset 0 0 12px rgba(0,0,0,.35)}
.login-field input:focus{outline:none;border-color:var(--accent-2);box-shadow:0 0 12px rgba(0,186,255,.3),inset 0 0 12px rgba(0,0,0,.45)}
.login-status,.leaderboard-warning{margin-top:12px;font-size:13px;min-height:18px}
.leaderboard-list{list-style:none;margin:18px 0;padding:0;display:flex;flex-direction:column;gap:10px;counter-reset:rank}
.leaderboard-list li{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:16px;background:rgba(0,0,0,.4);border:1px solid rgba(0,186,255,.2);box-shadow:0 10px 30px rgba(0,0,0,.45)}
.leaderboard-list li:nth-child(1){border-color:rgba(255,212,124,.45);box-shadow:0 12px 30px rgba(255,212,124,.25)}
.leaderboard-list li:nth-child(2){border-color:rgba(0,186,255,.35)}
.leaderboard-list li:nth-child(3){border-color:rgba(23,231,164,.4)}
.rank-glow{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;letter-spacing:.15em;color:#fff;background:radial-gradient(circle,rgba(0,186,255,.9),rgba(0,186,255,.2));box-shadow:0 0 25px rgba(0,186,255,.4)}
.leaderboard-list li:nth-child(1) .rank-glow{background:radial-gradient(circle,rgba(255,212,124,.9),rgba(255,212,124,.2));color:#1c1410}
.leaderboard-list li:nth-child(2) .rank-glow{background:radial-gradient(circle,rgba(180,216,255,.9),rgba(180,216,255,.2))}
.leaderboard-list li:nth-child(3) .rank-glow{background:radial-gradient(circle,rgba(23,231,164,.9),rgba(23,231,164,.2))}
.rank-name{display:flex;flex-direction:column;gap:4px;font-size:15px;flex:1}
.rank-name .rank{font-weight:600;color:#e9fbff;text-transform:uppercase;letter-spacing:.2em}
.rank-name .rank.clickable{cursor:pointer;text-decoration:underline;text-decoration-style:dotted;text-decoration-color:rgba(0,186,255,.7)}
.rank-name .waves{font-size:12px;color:#8aa7c7;letter-spacing:.15em;text-transform:uppercase}
.leaderboard-warning{padding:10px 14px;border-radius:14px;border:1px solid rgba(0,186,255,.25);background:rgba(0,186,255,.08);text-align:center;font-size:12px;letter-spacing:.2em;text-transform:uppercase}
.leaderboard-warning.warn{border-color:rgba(255,212,124,.4);background:rgba(255,212,124,.12);color:#ffd47c;box-shadow:0 0 15px rgba(255,212,124,.35)}
.leaderboard-warning.signed-in{border-color:rgba(23,231,164,.35);background:rgba(23,231,164,.1);color:#a8ffdc}
.leaderboard-dev-warning{display:none;margin-top:10px;padding:10px;border-radius:12px;background:rgba(255,83,112,.15);border:1px solid rgba(255,83,112,.5);color:#ff8a9a;font-size:12px;letter-spacing:.15em;text-transform:uppercase;text-align:center}
.leaderboard-dev-warning.visible{display:block}
.mainmenu-panel .actions{flex-wrap:wrap;gap:12px}
.mainmenu-panel .actions button{flex:1 1 120px}

.lb-search-row{display:flex;gap:8px;margin-top:10px}
.lb-search-row input{flex:1 1 auto;min-width:0;padding:6px 12px;border-radius:999px;border:1px solid rgba(148,163,184,.8);background:rgba(11,18,30,.96);color:#e9fbff;font-size:13px}
.lb-search-row input::placeholder{color:#64748b}
.lb-search-row button{flex:0 0 auto}

@keyframes neonPulse{
  0%,100%{text-shadow:0 0 20px rgba(0,186,255,.6),0 0 60px rgba(23,231,164,.35);filter:drop-shadow(0 0 10px rgba(23,231,164,.35))}
  50%{text-shadow:0 0 40px rgba(0,255,204,.9),0 0 80px rgba(0,186,255,.8);filter:drop-shadow(0 0 18px rgba(0,186,255,.45))}
}
@keyframes orbitSpin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes menuFlow{from{transform:rotate(0deg)}to{transform:rotate(-360deg)}}
@keyframes gridPulse{0%,100%{opacity:.12}50%{opacity:.22}}

/* Assembly War overlay */
#assembly-overlay{position:fixed;inset:0;min-height:100vh;padding:40px 16px 72px;align-items:flex-start;background:radial-gradient(130% 130% at 80% 0%,#031426 0%,#050b13 45%,#010306 100%);overflow-y:auto;z-index:850}
#assembly-overlay::before{content:\"\";position:absolute;inset:-20%;background:conic-gradient(from 90deg,#0ff5c933,#00baff33,#0062ff22,#8f63ff22,#0ff5c933);filter:blur(70px);opacity:.75;animation:menuFlow 24s linear infinite reverse}
#assembly-overlay::after{content:\"\";position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.03) 1px,transparent 1px);background-size:140px 140px;opacity:.12;mix-blend-mode:screen;animation:gridPulse 8s ease-in-out infinite reverse}
#assembly-overlay > *{position:relative;z-index:1}
#assembly-overlay .panel{max-width:1120px;width:100%;padding:48px;border-radius:28px;background:rgba(5,11,18,.92);box-shadow:0 25px 120px rgba(0,0,0,.8),0 0 45px rgba(0,186,255,.3),inset 0 0 0 1px rgba(255,255,255,.05);max-height:calc(100vh - 160px);overflow:auto}
#assembly-overlay h3{font-size:clamp(32px,3vw,56px);text-transform:uppercase;letter-spacing:.35em;margin-bottom:6px;color:#a7f5ff;text-shadow:0 0 20px rgba(0,186,255,.4)}
#assembly-overlay .tag{font-size:16px;color:#8aa7c7;margin-bottom:28px;letter-spacing:.15em;text-transform:uppercase}
#assembly-overlay .mission-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;width:100%}
#assembly-overlay .construction-note{margin:0 0 10px;color:#ffcfdf;letter-spacing:.12em;text-transform:uppercase;font-weight:600;font-size:12px;text-shadow:0 0 12px rgba(255,83,112,.35)}
#assembly-overlay .mission-card{position:relative;border:1px solid rgba(0,186,255,.2);border-radius:18px;padding:20px 18px;text-align:left;background:linear-gradient(145deg,rgba(0,186,255,.08),rgba(23,231,164,.03));color:var(--text);box-shadow:0 15px 40px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.03);transition:transform .25s ease, border-color .25s ease, box-shadow .25s ease}
#assembly-overlay .mission-card h4{margin:0 0 6px;font-size:18px;letter-spacing:.05em;color:#dff9ff}
#assembly-overlay .mission-card p{margin:4px 0;color:var(--muted);font-size:13px}
#assembly-overlay .mission-card:hover{transform:translateY(-6px);border-color:var(--accent-2);box-shadow:0 20px 50px rgba(0,186,255,.35)}
#assembly-overlay .mission-card.locked{border-color:rgba(255,255,255,.08);background:linear-gradient(145deg,rgba(255,255,255,.04),rgba(0,0,0,.15));opacity:.65;cursor:not-allowed}
#assembly-overlay .mission-card.locked::before{content:\"\\1F512\";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:44px;color:rgba(255,138,154,.9);text-shadow:0 0 18px rgba(255,83,112,.6);pointer-events:none}
#assembly-overlay .mission-card.locked::after{content:\"Locked\";position:absolute;top:16px;right:18px;font-size:12px;letter-spacing:.25em;text-transform:uppercase;color:#ff8a9a;text-shadow:0 0 10px rgba(255,83,112,.5)}
#assembly-overlay .mission-card.locked:hover{transform:none;box-shadow:0 15px 40px rgba(0,0,0,.45)}
#assembly-overlay .actions{margin-top:32px}

/* Sandbox Lab overlay */
#sandbox-overlay{position:fixed;inset:0;min-height:100vh;padding:56px 16px 80px;align-items:flex-start;background:radial-gradient(130% 130% at 20% 0%,#020814 0%,#030611 45%,#010307 100%);overflow-y:auto;z-index:850}
#sandbox-overlay > *{position:relative;z-index:1}
#assembly-overlay .actions button{flex:1;background:linear-gradient(120deg,rgba(0,186,255,.25),rgba(23,231,164,.15));border-radius:12px;min-width:160px;font-weight:600;letter-spacing:.1em;text-transform:uppercase}

/* Shop cards */
.shop-items{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:8px 0}
.shop-abilities{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:8px 0}
.shop-subtitle{margin:10px 0 6px;color:var(--muted);font-weight:600;text-align:left}
.shop-card{position:relative;display:flex;flex-direction:column;gap:8px;padding:12px;border:1px solid rgba(255,255,255,.12);border-radius:10px;background:var(--panel);padding-bottom:60px}
.shop-items .shop-card{min-height:220px}
.shop-abilities .shop-card{min-height:260px}
.shop-card h4{margin:0;color:var(--text);font-size:16px}
.shop-card .desc{color:var(--muted);font-size:13px}
.shop-card .price{color:var(--muted);font-size:12px}
.shop-card button{position:absolute;left:50%;bottom:14px;transform:translateX(-50%);display:inline-flex;justify-content:center;align-items:center;height:40px;min-width:120px;padding:0 14px}
.shop-card.purchased{opacity:.6}

/* Shop close (red X) */
.shop-close{position:absolute;top:8px;right:10px;border:0;background:transparent;color:#ff8a9a;font-weight:bold;font-size:18px;cursor:pointer}
.shop-close:hover{color:#ff5370}

/* Generic level dots (used in shop + upgrade panel) */
.level-dots{display:flex;gap:4px;align-items:center;margin-top:4px}
.level-dots .dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.18);box-shadow:inset 0 0 0 1px rgba(255,255,255,.12)}
.level-dots .dot.dim{background:rgba(255,255,255,.28);box-shadow:inset 0 0 0 1px rgba(255,255,255,.18)}
.level-dots .dot.filled{background:var(--accent-2);box-shadow:0 0 6px rgba(0,186,255,.5), inset 0 0 0 1px rgba(0,186,255,.6)}

/* Ability buttons */
.abil-btn{
  border-color:rgba(255,255,255,.2);
}
.abil-btn:disabled{opacity:.55}
.abil-btn.locked{opacity:.55; filter:grayscale(40%)}
.abil-btn.ready{
  border-color:rgba(0,186,255,.5);
  box-shadow:0 0 12px rgba(0,186,255,.35);
}
.abil-btn.cooldown{
  border-color:rgba(255,255,255,.18);
  box-shadow:none;
}
.abil-btn.active{
  border-color:rgba(23,231,164,.8);
  box-shadow:0 0 16px rgba(23,231,164,.75);
  background:radial-gradient(circle at 20% 0%, rgba(255,255,255,0.12), rgba(0,0,0,0.9));
}

/* Map select thumbnails */
.map-select{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:6px}
.map-thumb{position:relative;border:1px solid rgba(255,255,255,.12);border-radius:10px;overflow:hidden;cursor:pointer;background:var(--panel)}
.map-thumb canvas{display:block;width:100%;height:auto}
.map-thumb .label{position:absolute;left:6px;bottom:6px;background:var(--panel);padding:2px 6px;border-radius:6px;font-size:12px;color:var(--text);border:1px solid rgba(255,255,255,.08)}
.map-thumb.selected{outline:2px solid var(--accent-2); box-shadow:0 0 0 2px var(--accent-2) inset}
.map-desc{margin-top:8px;color:var(--muted);font-size:13px;min-height:1.6em}
.mapselect-panel{max-width:880px;padding:22px 24px;box-shadow:0 10px 50px rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.06)}
.map-carousel{display:flex;align-items:center;justify-content:center;gap:12px;margin-top:12px}
.character-select{margin-top:16px;text-align:center}
.character-title{margin:0 0 6px;font-size:13px;letter-spacing:.18em;text-transform:uppercase;color:#a7f5ff}
.character-row{display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
.character-btn{
  position:relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-width:110px;
  padding:8px 10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.5);
  color:var(--text);
  font-size:13px;
  cursor:pointer;
  transition:all .16s ease;
  box-shadow:0 10px 24px rgba(0,0,0,.5);
}
.character-btn .character-icon{
  position:relative;
  width:56px;
  height:56px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-bottom:4px;
  border-radius:10px;
  overflow:hidden;
}
.character-btn .character-icon::before{
  content:none;
}
.character-btn .character-icon img{max-width:100%;max-height:100%;display:block;image-rendering:pixelated}
.character-btn .character-name{font-weight:600;letter-spacing:.14em;text-transform:uppercase;font-size:11px}
.character-btn:hover{
  border-color:var(--accent-2);
  box-shadow:0 10px 32px rgba(0,186,255,.35);
}
.character-btn:not(.selected){
  opacity:.8;
}
.character-btn:not(.selected) .character-icon{
  filter:brightness(.85) saturate(.8);
}
.character-btn.selected{
  opacity:1;
  background:radial-gradient(circle at 20% 0%, rgba(15,23,42,.98), rgba(0,0,0,1));
}
.character-btn.selected .character-icon{
  filter:none;
}
/* Per-character neon ring colors (dim by default, bright when selected) */
.character-btn[data-character="volt"] .character-icon{
  background:radial-gradient(circle at 20% 0%, rgba(34,197,94,.25), rgba(15,23,42,1));
  box-shadow:0 0 10px rgba(34,197,94,.45);
}
.character-btn[data-character="volt"] .character-icon::before{
  border-color:rgba(34,197,94,.6);
  box-shadow:0 0 12px rgba(34,197,94,.7),0 0 20px rgba(34,197,94,.5);
}
.character-btn.selected[data-character="volt"]{
  border-color:rgba(34,197,94,.9);
  box-shadow:0 0 0 1px rgba(34,197,94,.9),0 0 26px rgba(34,197,94,1);
}
.character-btn.selected[data-character="volt"] .character-icon::before{
  opacity:1;
  border-color:rgba(34,197,94,1);
  box-shadow:0 0 20px rgba(34,197,94,1),0 0 40px rgba(34,197,94,.95);
}
.character-btn[data-character="lumen"] .character-icon{
  background:radial-gradient(circle at 20% 0%, rgba(56,189,248,.25), rgba(15,23,42,1));
  box-shadow:0 0 10px rgba(56,189,248,.45);
}
.character-btn[data-character="lumen"] .character-icon::before{
  border-color:rgba(56,189,248,.65);
  box-shadow:0 0 12px rgba(56,189,248,.75),0 0 20px rgba(56,189,248,.55);
}
.character-btn.selected[data-character="lumen"]{
  border-color:rgba(56,189,248,.95);
  box-shadow:0 0 0 1px rgba(56,189,248,.95),0 0 26px rgba(56,189,248,1);
}
.character-btn.selected[data-character="lumen"] .character-icon::before{
  opacity:1;
  border-color:rgba(56,189,248,1);
  box-shadow:0 0 20px rgba(56,189,248,1),0 0 40px rgba(56,189,248,.97);
}
.character-btn[data-character="torque"] .character-icon{
  background:radial-gradient(circle at 20% 0%, rgba(249,115,22,.3), rgba(24,16,5,1));
  box-shadow:0 0 10px rgba(249,115,22,.5);
}
.character-btn[data-character="torque"] .character-icon::before{
  border-color:rgba(249,115,22,.7);
  box-shadow:0 0 12px rgba(249,115,22,.8),0 0 20px rgba(249,115,22,.55);
}
.character-btn.selected[data-character="torque"]{
  border-color:rgba(249,115,22,.98);
  box-shadow:0 0 0 1px rgba(249,115,22,.98),0 0 26px rgba(249,115,22,1);
}
.character-btn.selected[data-character="torque"] .character-icon::before{
  opacity:1;
  border-color:rgba(249,115,22,1);
  box-shadow:0 0 20px rgba(249,115,22,1),0 0 40px rgba(249,115,22,.97);
}
.map-nav{width:48px;height:48px;border-radius:12px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:var(--text);font-size:20px;cursor:pointer;transition:all 0.2s ease;box-shadow:0 12px 30px rgba(0,0,0,0.3)}
.map-nav:hover{border-color:var(--accent-2);box-shadow:0 12px 30px rgba(0,186,255,0.3)}
.map-center{display:flex;flex-direction:column;align-items:center;gap:8px;padding:12px 18px;border-radius:16px;background:rgba(8,12,18,0.75);border:1px solid rgba(255,255,255,0.05);box-shadow:0 12px 40px rgba(0,0,0,0.45)}
.map-center canvas{width:380px;max-width:100%;height:auto;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.35);background:rgba(255,255,255,0.02)}
.map-title{font-weight:700;font-size:20px;color:var(--text);text-align:center;margin-top:4px}
.map-dots{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:2px}
.map-dot{width:12px;height:12px;border-radius:50%;background:rgba(255,255,255,0.12);box-shadow:0 0 0 1px rgba(255,255,255,0.1)}
.map-dot.active{background:var(--accent-2);box-shadow:0 0 0 1px rgba(0,186,255,0.5),0 0 14px rgba(0,186,255,0.6)}
.map-meta{margin-top:10px;text-align:center}
.lb-layout{display:flex;flex-direction:column;align-items:center;gap:14px;justify-content:flex-start;}
.mapselect-panel.compact{max-width:720px;padding:18px 20px;margin-bottom:8px}
.mapselect-panel.compact .map-center canvas{width:320px}
#leaderboard-overlay{align-items:flex-start;justify-content:center}
#leaderboard-overlay .lb-layout{width:min(1080px,100%);margin:12px auto 8px}
.leaderboard-container{max-height:calc(100vh - 460px);min-height:280px;overflow-y:auto;width:100%;padding-right:6px;box-sizing:border-box;scrollbar-gutter:stable both-edges}
.leaderboard-container .leaderboard-list{margin-top:12px;}

#profile-overlay{align-items:flex-start;justify-content:center}
#profile-overlay .profile-layout{width:min(900px,100%);margin:12px auto 8px}
.profile-header{display:flex;flex-direction:column;gap:4px;margin-bottom:12px;text-align:left}
.profile-username{font-size:20px;letter-spacing:.2em;text-transform:uppercase;color:#e9fbff}
.profile-meta{display:flex;flex-wrap:wrap;gap:10px;font-size:12px;color:#8aa7c7;letter-spacing:.15em;text-transform:uppercase}
.profile-summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-bottom:16px}
.profile-stat{padding:10px 12px;border-radius:12px;background:rgba(0,0,0,.4);border:1px solid rgba(0,186,255,.16);text-align:left}
.profile-stat .label{font-size:11px;color:#8aa7c7;letter-spacing:.16em;text-transform:uppercase;margin-bottom:4px}
.profile-stat .value{font-size:15px;color:#e9fbff}
.profile-section{margin-top:8px;text-align:left}
.profile-section h3{margin:0 0 6px;font-size:13px;text-transform:uppercase;letter-spacing:.2em;color:#94a3b8}
.profile-map-list,
.profile-run-list{list-style:none;margin:0;padding:0;max-height:220px;overflow-y:auto}
.profile-map-list li,
.profile-run-list li{font-size:13px;color:#e9fbff;padding:6px 8px;border-radius:8px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.06);margin-bottom:4px}
.profile-run-list li small{display:block;font-size:11px;color:#8aa7c7}
.profile-empty{font-size:12px;color:#8aa7c7;margin:4px 0 0}
.profile-status{text-align:center;font-size:13px;color:#8aa7c7;margin-top:10px;display:none}
.profile-status.error{color:#ff8a9a}

.lb-map-bar{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:12px}
.lb-map-nav{width:40px;height:40px;border-radius:10px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.04);color:var(--text);font-size:18px;cursor:pointer;transition:all 0.2s ease}
.lb-map-nav:hover{border-color:var(--accent-2);box-shadow:0 8px 20px rgba(0,186,255,0.25)}
.lb-map-center{display:flex;flex-direction:column;align-items:center;gap:6px;padding:10px 14px;border-radius:14px;background:rgba(8,12,18,0.7);border:1px solid rgba(255,255,255,0.04)}
.lb-map-center canvas{width:240px;max-width:100%;height:auto;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.3)}
.lb-map-title{font-weight:700;color:var(--text)}

.footer{margin-top:auto;padding:8px 16px;color:var(--muted);font-size:12px;opacity:.8}

/* Upgrade panel */
.upgrade{
  position:absolute;
  right:24px;
  bottom:96px;
  left:auto;
  z-index:80;
  display:flex;
  flex-direction:column;
  gap:10px;
  background:var(--panel);
  border:1px solid rgba(255,255,255,.12);
  border-radius:12px;
  padding:14px 16px;
  min-width:300px;
  width:min(520px, calc(100vw - 32px));
  max-height:calc(100vh - 140px);
  box-shadow:0 10px 30px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.06);
  overflow:auto;
}
.upgrade.sticky-center{
  left:50%;
  right:auto;
  transform:translateX(-50%);
}
.upgrade .upg-close{position:absolute;top:6px;right:8px;border:0;background:transparent;color:var(--muted);font-size:18px;cursor:pointer}
.upgrade .upg-close:hover{color:var(--text)}
.upgrade .upg-title{font-size:13px;color:var(--muted);display:flex;align-items:center;gap:8px}
.upgrade .upg-icon{display:inline-block;width:12px;height:12px;border-radius:50%;background:var(--accent-2);box-shadow:0 0 8px rgba(0,186,255,.5)}
.upgrade .upg-name{color:var(--text)}
.upgrade .upg-actions{display:flex;gap:8px;flex-wrap:wrap}
.sell-btn{border:1px solid rgba(255,83,112,.6);color:#ffd5db;background:linear-gradient(180deg, rgba(255,83,112,.15), rgba(255,83,112,.08))}
.sell-btn:hover{border-color:#ff5370}

/* Upgrade panel toast */
.upg-toast{position:absolute;left:50%;top:-6px;transform:translate(-50%,-100%);padding:6px 10px;border-radius:8px;font-size:12px;background:linear-gradient(180deg, rgba(255,83,112,.2), rgba(255,83,112,.1));border:1px solid rgba(255,83,112,.55);color:#ffd5db;box-shadow:0 8px 20px rgba(0,0,0,.35);pointer-events:none;opacity:0;animation:upgToast 1.1s ease-out forwards}
@keyframes upgToast{0%{opacity:0;transform:translate(-50%,-110%)}20%{opacity:1;transform:translate(-50%,-130%)}100%{opacity:0;transform:translate(-50%,-180%)}}
.upgrade .upg-hint{font-size:11px;color:var(--muted)}

@media (max-width: 860px){
  .upgrade{
    left:50%;
    right:auto;
    bottom:16px;
    transform:translateX(-50%);
    width:min(520px, calc(100vw - 24px));
  }
}

/* Floating tooltip card (for ability buttons) */
.tooltip-card{position:fixed;z-index:9999;max-width:260px;background:var(--panel);border:1px solid rgba(255,255,255,.14);border-radius:10px;padding:10px 12px;box-shadow:0 10px 30px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.04);color:var(--text);font-size:12px;pointer-events:none}
.tooltip-card .tt-title{font-weight:700;color:var(--accent-2);margin:0 0 4px 0;font-size:13px}
.tooltip-card .tt-line{margin:2px 0;color:var(--muted)}
.has-dots{ position:relative }
.has-dots .level-dots{ position:absolute; right:8px; top:50%; transform:translateY(-50%); display:flex; gap:4px; pointer-events:none; margin:0 }
.has-dots .level-dots .dot{ width:8px; height:8px }
/* ===== Custom Layout Overrides ===== */
.hud{
  position:sticky;
  top:0;
  z-index:40;
  display:grid;
  grid-template-columns:minmax(240px,1fr) minmax(160px,max-content) repeat(3,max-content);
  grid-auto-rows:max-content;
  gap:0 6px;
  padding:2px 20px 2px;
  background:rgba(5,11,18,.92);
  border-bottom:1px solid rgba(0,186,255,.18);
  box-shadow:0 8px 18px rgba(0,0,0,.45);
  backdrop-filter:blur(18px);
  align-items:end;
}
.hud-title-floating{
  position:absolute;
  top:4px;
  left:50%;
  transform:translateX(-50%);
  text-align:center;
  pointer-events:none;
  line-height:1.05;
}
.hud-title-floating h1{
  margin:0;
  font-size:20px;
  letter-spacing:.6px;
  color:var(--accent);
  text-transform:uppercase;
}
.hud-title-floating .hud-sub{
  margin:0;
  color:#8aa7c7;
  letter-spacing:.32em;
  text-transform:uppercase;
  font-size:8.5px;
}
.hud-grid{
  display:contents;
}
.hud-cell{
  background:rgba(255,255,255,.02);
  border:1px solid rgba(255,255,255,.04);
  border-radius:12px;
  padding:4px 10px;
  min-height:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:6px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.02), 0 6px 14px rgba(0,0,0,.35);
  justify-self:start;
}
.hud-cell:not(.hud-stats){
  padding:3px 8px;
}
.hud-stats{
  flex-direction:column;
  align-items:stretch;
  justify-content:center;
  gap:6px;
  justify-self:stretch;
  width:100%;
}
.hud-hp{
  flex-direction:column;
  align-items:stretch;
  justify-content:center;
  gap:6px;
  min-width:220px;
  position:relative;
}
.hud-hpframe{
  display:flex;
  flex-direction:column;
  align-items:stretch;
  gap:8px;
}
.hp-char-icon{
  flex:0 0 auto;
  width:100%;
  max-width:128px;
  height:128px;
  border-radius:18px;
  padding:3px;
  background:radial-gradient(circle at 20% 0%, rgba(20,184,166,.4), rgba(2,6,23,1));
  box-shadow:0 16px 40px rgba(0,0,0,.75),0 0 26px rgba(0,186,255,.45),inset 0 0 0 1px rgba(255,255,255,.06);
  position:relative;
  overflow:visible;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0 auto;
}
.hp-char-icon::before{
  content:"";
  position:absolute;
  inset:-6px;
  border-radius:inherit;
  border:2px solid rgba(0,186,255,.4);
  box-shadow:0 0 22px rgba(0,186,255,.7),0 0 40px rgba(0,186,255,.5);
  opacity:.9;
  pointer-events:none;
}
.hp-char-icon.theme-volt{
  background:radial-gradient(circle at 20% 0%, rgba(34,197,94,.7), rgba(2,6,23,1));
  box-shadow:0 18px 42px rgba(0,0,0,.8),0 0 34px rgba(34,197,94,.8),inset 0 0 0 1px rgba(190,255,220,.55);
}
.hp-char-icon.theme-lumen{
  background:radial-gradient(circle at 20% 0%, rgba(45,212,255,.75), rgba(15,23,42,1));
  box-shadow:0 18px 42px rgba(0,0,0,.8),0 0 34px rgba(56,189,248,.85),inset 0 0 0 1px rgba(186,230,253,.6);
}
.hp-char-icon.theme-torque{
  background:radial-gradient(circle at 20% 0%, rgba(249,115,22,.8), rgba(24,16,5,1));
  box-shadow:0 18px 42px rgba(0,0,0,.8),0 0 34px rgba(249,115,22,.9),inset 0 0 0 1px rgba(254,215,170,.7);
}
.hp-char-inner{
  width:100%;
  height:100%;
  border-radius:14px;
  background:rgba(2,8,20,.08);
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  overflow:hidden;
}
.hp-char-icon.theme-volt .hp-char-inner{
  box-shadow:inset 0 0 0 1px rgba(190,255,220,.55),0 0 14px rgba(34,197,94,.85);
}
.hp-char-icon.theme-lumen .hp-char-inner{
  box-shadow:inset 0 0 0 1px rgba(186,230,253,.65),0 0 16px rgba(56,189,248,.9);
}
.hp-char-icon.theme-torque .hp-char-inner{
  box-shadow:inset 0 0 0 1px rgba(254,215,170,.75),0 0 16px rgba(249,115,22,.95);
}
.hp-char-icon.theme-volt::before{
  border-color:rgba(34,197,94,.7);
  box-shadow:0 0 26px rgba(34,197,94,1),0 0 48px rgba(34,197,94,.9);
}
.hp-char-icon.theme-lumen::before{
  border-color:rgba(56,189,248,.8);
  box-shadow:0 0 26px rgba(56,189,248,1),0 0 48px rgba(56,189,248,.95);
}
.hp-char-icon.theme-torque::before{
  border-color:rgba(249,115,22,.9);
  box-shadow:0 0 26px rgba(249,115,22,1),0 0 48px rgba(249,115,22,.95);
}
.hp-char-sprite{
  width:100%;
  height:100%;
  display:block;
  background:
    radial-gradient(circle at 30% 0%, rgba(0,0,0,0.55), transparent 55%),
    radial-gradient(circle at 70% 100%, rgba(0,0,0,0.75), transparent 60%),
    url('data/control-room.png') center center/cover no-repeat;
  filter:brightness(0.6) contrast(1.1) saturate(0.9);
}

/* Subtle CRT scanline / glow effect over the pilot camera feed */
.hp-char-inner::after{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius:inherit;
  background-image:
    linear-gradient(rgba(255,255,255,0.09) 1px, rgba(0,0,0,0.0) 2px),
    radial-gradient(circle at 50% 0%, rgba(255,255,255,0.08), transparent 55%);
  background-size:100% 2px, 160% 220%;
  mix-blend-mode:screen;
  opacity:0.8;
  pointer-events:none;
  animation:crtSweep 6s linear infinite;
}

@keyframes crtSweep{
  0%{transform:translateY(-2px);}
  50%{transform:translateY(2px);}
  100%{transform:translateY(-2px);}
}
.hud-hpbar{
  display:flex;
  flex-direction:column;
  gap:6px;
  flex:1 1 auto;
}

.pilot-dialog{
  position:absolute;
  left:130px;
  top:4px;
  width:520px;
  max-width:520px;
  padding:10px 18px;
  border-radius:12px;
  background:linear-gradient(135deg, rgba(10,18,32,0.98), rgba(3,10,24,0.96));
  border:1px solid rgba(0,186,255,0.6);
  box-shadow:0 14px 36px rgba(0,0,0,0.75),0 0 20px rgba(0,186,255,0.6);
  font-size:19px;
  line-height:1.35;
  color:#d8f5ff;
  letter-spacing:.04em;
  text-transform:none;
  pointer-events:none;
  opacity:0;
  transform:translateY(-4px);
  transition:opacity .25s ease-out, transform .25s ease-out;
  z-index:5;
}
.pilot-dialog.visible{
  opacity:1;
  transform:translateY(0);
}
.pilot-dialog::before{
  content:"";
  position:absolute;
  left:22px;
  bottom:-7px;
  width:12px;
  height:7px;
  background:inherit;
  border-bottom:1px solid rgba(0,186,255,0.6);
  border-right:1px solid rgba(0,186,255,0.6);
  transform:skewX(-28deg);
  box-shadow:0 8px 18px rgba(0,0,0,0.7);
}
.pilot-dialog[data-char="volt"]{
  border-color:rgba(34,197,94,.85);
  box-shadow:0 14px 36px rgba(0,0,0,0.75),0 0 22px rgba(34,197,94,0.9);
}
.pilot-dialog[data-char="lumen"]{
  border-color:rgba(56,189,248,.9);
  box-shadow:0 14px 36px rgba(0,0,0,0.75),0 0 22px rgba(56,189,248,0.95);
}
.pilot-dialog[data-char="torque"]{
  border-color:rgba(249,115,22,.95);
  box-shadow:0 14px 36px rgba(0,0,0,0.75),0 0 22px rgba(249,115,22,0.98);
}
.hud-controls,.hud-abilities,.hud-towers{gap:8px}
.hud-controls{
  flex-direction:column;
  align-items:stretch;
  justify-content:flex-end;
  gap:6px;
}
.hud-controls .control-row{
  display:flex;
  flex-wrap:nowrap;
  gap:6px;
  width:auto;
}
.control-dev{display:flex;justify-content:flex-end}
.hud-abilities,.hud-towers{
  display:flex;
  align-items:center;
}
.hud-abilities{
  justify-content:flex-start;
  flex-wrap:nowrap;
  gap:6px;
  width:auto;
}
.hud-towers{justify-content:flex-end}
.hud-towers .tower-palette{width:auto}
.hud-controls button{
  flex:1 1 auto;
  min-width:90px;
  white-space:nowrap;
  padding:4px 9px;
  font-size:11px;
}
.hud-abilities .abil-btn{
  flex:1 1 auto;
  min-width:90px;
  white-space:nowrap;
  text-align:center;
  padding:5px 9px;
  font-size:11px;
  min-height:32px;
  max-height:32px;
  line-height:1.1;
  overflow:hidden;
  text-overflow:ellipsis;
}
/* Start Wave: prominent red call-to-action */
#btn-start-wave{
  font-weight:700;
  letter-spacing:.18em;
  text-transform:uppercase;
  color:#ffe5e5;
  background:linear-gradient(135deg, rgba(248,113,113,0.25), rgba(248,113,113,0.05));
  border-color:rgba(248,113,113,0.8);
  box-shadow:0 0 18px rgba(248,113,113,0.5),0 10px 30px rgba(0,0,0,0.45);
}
#btn-start-wave:hover{
  border-color:#fecaca;
  box-shadow:0 0 24px rgba(248,113,113,0.7),0 12px 34px rgba(0,0,0,0.6);
}
/* Speed control: simple text fast-forward icon + xN label */
#btn-fast{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:4px;
}
#btn-fast .ff-icon{
  font-size:18px;
  color:#facc15;
  text-shadow:0 0 12px rgba(250,204,21,0.9);
}
#btn-fast .ff-label{
  font-size:13px;
  color:#f9fafb;
  text-shadow:0 0 6px rgba(148,163,184,0.6);
}
#btn-pause{
  font-size:16px;
}
#btn-pause[data-state="pause"]{
  color:#e5e7eb;
  text-shadow:0 0 8px rgba(148,163,184,0.65);
}
#btn-pause[data-state="resume"]{
  color:#4ade80;
  text-shadow:0 0 10px rgba(74,222,128,0.9);
}
.currency-box{
  width:100%;
  padding:4px 6px 6px;
  border-radius:14px;
  border:1px solid rgba(0,186,255,.25);
  background:linear-gradient(120deg,rgba(0,186,255,.06),rgba(23,231,164,.04));
  display:flex;
  flex-direction:column;
  gap:4px;
  box-shadow:inset 0 0 14px rgba(0,0,0,.35);
}
.currency-header{
  font-size:11px;
  letter-spacing:.6em;
  text-transform:uppercase;
  color:#bff8ff;
  opacity:.85;
}
.currency-rail{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:6px;
  align-items:stretch;
}
.currency-chip{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:12px;
  background:rgba(0,0,0,.4);
  border:1px solid rgba(255,255,255,.05);
  box-shadow:inset 0 0 12px rgba(0,0,0,.45);
  min-width:0;
  cursor:help;
}
.currency-chip .chip-icon{
  width:28px;
  height:28px;
  border-radius:12px;
  position:relative;
  overflow:hidden;
  background:rgba(2,5,9,.8);
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 0 12px rgba(0,0,0,.7) inset;
}
.currency-chip .chip-icon::before,
.currency-chip .chip-icon::after{
  content:"";
  position:absolute;
  inset:4px;
  border-radius:50%;
  border:2px solid transparent;
}
.currency-chip.credit .chip-icon::before{
  border-color:#17e7a4;
  animation:currencySpin 4s linear infinite;
}
.currency-chip.credit .chip-icon::after{
  inset:10px;
  border-color:rgba(23,231,164,.3);
  animation:currencyPulse 2s ease-in-out infinite;
}
.currency-chip.fragment .chip-icon::before{
  border-radius:4px;
  border:2px solid #00baff;
  animation:currencyShard 3s linear infinite;
}
.currency-chip.fragment .chip-icon::after{
  inset:8px;
  border-radius:4px;
  background:rgba(0,186,255,.4);
  filter:blur(2px);
  animation:currencyGlow 2.4s ease-in-out infinite;
}
.currency-chip.core .chip-icon::before{
  border-radius:0;
  border:2px solid #ffd47c;
  animation:currencyCore 3.6s linear infinite;
}
.currency-chip.core .chip-icon::after{
  inset:9px;
  border-radius:0;
  background:rgba(255,212,124,.5);
  animation:currencyPulse 2.4s ease-in-out infinite;
}
.chip-copy{display:flex;flex-direction:column;line-height:1.2}
.chip-label{font-size:11px;letter-spacing:.25em;text-transform:uppercase;color:#9fc9ff}
.chip-value{font-size:16px;font-weight:600;color:#fff;text-shadow:0 0 8px rgba(0,186,255,.5)}
.hud-hp span:first-child{font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:#c6f3ff}
.hud-hp{
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:13px;
  color:#9fd8ff;
  padding:8px 10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.06);
  background:rgba(255,255,255,.02);
  width:100%;
}
@keyframes currencySpin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes currencyPulse{0%,100%{opacity:.4;transform:scale(.85)}50%{opacity:1;transform:scale(1)}}
@keyframes currencyShard{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
@keyframes currencyGlow{0%,100%{opacity:.5;transform:scale(.9)}50%{opacity:1;transform:scale(1.05)}}
@keyframes currencyCore{0%{transform:rotate(0deg)}100%{transform:rotate(-360deg)}}
#canvas-shell{
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:2px 6px 0;
  margin:0;
  width:100%;
  position:relative;
}
#canvas-shell canvas{
  width:100%;
  height:auto;
  aspect-ratio:16/9;
  max-width:100%;
}
/* Combat stats overlay */
#combat-stats{
  position:absolute;
  top:8px;
  left:8px;
  z-index:120;
  padding:10px 14px;
  min-width:210px;
  width:210px;
  border-radius:14px;
  background:rgba(8,12,18,0.9);
  border:1px solid rgba(0,186,255,0.18);
  box-shadow:0 14px 30px rgba(0,0,0,0.45), inset 0 0 0 1px rgba(255,255,255,0.04);
  backdrop-filter:blur(8px);
  color:#cfe9ff;
}
#combat-stats.minimized{
  padding:6px 10px;
}
.combat-stats-card.minimized .cs-title{
  margin-bottom:0;
}
.combat-stats-card.minimized .cs-row{
  display:none;
}
.combat-stats-card .cs-title{
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:12px;
  letter-spacing:.25em;
  text-transform:uppercase;
  color:#8ab6de;
  margin-bottom:6px;
}
.combat-stats-card #combat-stats-toggle{
  margin-left:8px;
  min-width:22px;
  height:22px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.25);
  background:rgba(0,0,0,0.3);
  color:#e5f2ff;
  font-size:14px;
  line-height:1;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.combat-stats-card #combat-stats-toggle:hover{
  background:rgba(0,186,255,0.15);
  border-color:rgba(0,186,255,0.6);
}
.combat-stats-card .cs-row{
  display:grid;
  grid-template-columns: 1.6fr auto auto;
  column-gap:12px;
  align-items:center;
  font-size:13px;
  padding:5px 0;
  border-bottom:1px solid rgba(255,255,255,0.05);
}
.combat-stats-card .cs-row:last-child{ border-bottom:none; }
.combat-stats-card .cs-row:not(.cs-header) span:nth-child(2){ font-weight:700; color:#fff; }
.combat-stats-card .cs-header{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.08em;
  color:rgba(197,216,240,0.85);
  border-bottom:1px solid rgba(255,255,255,0.12);
  padding-bottom:3px;
}
.combat-stats-card .cs-row span:nth-child(2),
.combat-stats-card .cs-row span:nth-child(3){
  text-align:right;
}
.combat-stats-card .cs-row:not(.cs-header) span:nth-child(2),
.combat-stats-card .cs-row:not(.cs-header) span:nth-child(3){
  padding-left:8px;
  border-left:1px solid rgba(255,255,255,0.08);
}
.combat-stats-card .cs-header span:nth-child(2),
.combat-stats-card .cs-header span:nth-child(3){
  padding-left:8px;
  border-left:1px solid rgba(255,255,255,0.18);
}
.stage-wrap{
  --side-panel-width: clamp(200px, 14vw, 240px);
  flex:1;
  display:grid;
  grid-template-columns:var(--side-panel-width) minmax(300px,1fr) var(--side-panel-width);
  gap:10px;
  padding:14px 0 16px;
  /* Space backdrop behind the central game column and side panels,
   * constrained to the stage area so the global loading GIF remains
   * visible in the outer margins. */
  background:#020308 url('data/Space-Background.png') center bottom/cover no-repeat;
  align-items:stretch;
  margin-top:0;
}
.wave-panel,.passive-panel{
  width:100%;
  height:100%;
  min-width:0;
  flex:1 1 auto;
  border-radius:16px;
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(0,0,0,.18));
  border:1px solid rgba(255,255,255,.06);
  box-shadow:0 12px 30px rgba(0,0,0,.5);
  padding:11px 12px;
  display:flex;
  flex-direction:column;
  gap:10px;
  overflow-y:auto;
  overflow-x:hidden;
}
.passive-panel{
  position:relative;
}
.pp-lines{
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  min-height:0;
}
.passive-slot-scroll{
  flex:1 1 auto;
  min-height:0;
  overflow-y:auto;
  overflow-x:hidden;
  padding-right:4px;
}
.passive-panel.compact{
  padding:8px 9px;
  gap:7px;
}
.wave-panel-top{display:flex;justify-content:space-between;align-items:center;gap:8px}
/* Center the wave-status pill at the top of the wave panel */
.wave-panel-top{
  flex-direction:column;
  align-items:flex-start;
}
.wave-panel-top #wave-status{
  align-self:center;
  width:100%;
  max-width:240px;
}
.wave-panel-top #stat-wave{
  font-size:18px;
  font-weight:600;
  letter-spacing:.2em;
  text-transform:uppercase;
  color:#f0fbff;
}
.wave-metrics{display:flex;flex-direction:column;gap:6px}
.wave-metric{display:flex;justify-content:space-between;padding:6px 8px;border-radius:10px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.05);font-size:12px}
.wave-metric .value{color:#e5f6ff;font-weight:600}
.banner-feed{flex:1;border:1px solid rgba(255,255,255,.05);border-radius:12px;padding:10px;background:rgba(0,0,0,.35);overflow:auto;display:flex;flex-direction:column;gap:8px}
.banner-entry{border-radius:10px;border:1px solid rgba(255,255,255,.08);padding:8px 10px;font-size:12px}
.banner-entry .be-title{font-weight:600;color:#fff}
.banner-entry .be-sub{color:var(--muted)}
.banner-entry.banner-danger{border-color:rgba(255,83,112,.6);background:rgba(255,83,112,.12)}
.banner-entry.banner-accent{border-color:rgba(23,231,164,.5);background:rgba(23,231,164,.1)}
.banner-entry.banner-warning{border-color:rgba(255,212,124,.5);background:rgba(255,212,124,.12)}
.banner-entry.banner-crit{border-color:rgba(255,212,124,.8);background:rgba(255,212,124,.18)}
.banner-entry.banner-boss{border-color:rgba(199,125,255,.8);background:rgba(199,125,255,.18)}
.banner-entry.banner-hp{border-color:rgba(128,226,126,.8);background:rgba(128,226,126,.18)}
.banner-entry.banner-bonus{border-color:rgba(124,224,255,.8);background:rgba(124,224,255,.18)}
.pp-meta{font-size:12px;letter-spacing:.25em;text-transform:uppercase;color:#8ab6de;margin-top:-2px;margin-bottom:4px}
.passive-panel.compact .pp-meta{margin-bottom:2px;font-size:10.5px;letter-spacing:.18em}
.passive-slot-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
.passive-panel.compact .passive-slot-grid{grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:6px}
.passive-slot{position:relative;border:1px solid rgba(255,255,255,.05);border-radius:16px;padding:11px 12px;min-height:120px;background:linear-gradient(160deg,rgba(255,255,255,.03),rgba(0,0,0,.25));display:flex;flex-direction:column;gap:7px;box-shadow:inset 0 0 18px rgba(0,0,0,.4);transition:border-color .2s ease,box-shadow .2s ease}
.passive-panel.compact .passive-slot{padding:8px 9px;min-height:92px;gap:5px;border-radius:14px}
.passive-slot::after{content:\"\";position:absolute;inset:8px;border-radius:12px;border:1px solid rgba(255,255,255,.03);pointer-events:none}
.passive-slot.filled{border-color:rgba(0,186,255,.35);box-shadow:0 12px 26px rgba(0,0,0,.4),inset 0 0 22px rgba(0,0,0,.4)}
.passive-slot.tier-common{border-color:rgba(44,204,126,.35);box-shadow:0 10px 24px rgba(0,0,0,.35), inset 0 0 22px rgba(44,204,126,.12);background:linear-gradient(160deg,rgba(44,204,126,.16),rgba(0,0,0,.25))}
.passive-slot.tier-rare{border-color:rgba(255,83,112,.45);box-shadow:0 12px 28px rgba(0,0,0,.4), inset 0 0 22px rgba(255,83,112,.16);background:linear-gradient(160deg,rgba(255,83,112,.22),rgba(0,0,0,.28))}
.passive-slot.tier-super{border-color:rgba(170,123,255,.5);box-shadow:0 14px 32px rgba(0,0,0,.45), inset 0 0 24px rgba(170,123,255,.18);background:linear-gradient(160deg,rgba(170,123,255,.25),rgba(0,0,0,.3))}
.slot-tier-badge{align-self:flex-start;font-size:10px;letter-spacing:.3em;text-transform:uppercase;border-radius:999px;padding:4px 8px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12)}
.slot-tier-badge.tier-common{color:#92f4c1;border-color:rgba(44,204,126,.45);background:rgba(44,204,126,.12)}
.slot-tier-badge.tier-rare{color:#ff9cae;border-color:rgba(255,83,112,.55);background:rgba(255,83,112,.15)}
.slot-tier-badge.tier-super{color:#d9c4ff;border-color:rgba(170,123,255,.6);background:rgba(170,123,255,.18)}
.slot-name{font-weight:600;color:#e6faff;font-size:15px}
.passive-panel.compact .slot-name{font-size:13.5px}
.slot-desc{
  font-size:12px;
  color:#8aa7c7;
  line-height:1.4;
  display:-webkit-box;
  -webkit-line-clamp:3;
  -webkit-box-orient:vertical;
  overflow:hidden;
}
.passive-panel.compact .slot-desc{font-size:11px;line-height:1.3}
.slot-refund{margin-top:auto;align-self:flex-start;font-size:12px;padding:6px 12px;border-radius:999px;background:linear-gradient(120deg,rgba(0,186,255,.25),rgba(23,231,164,.18));border:1px solid rgba(0,186,255,.35);letter-spacing:.15em;text-transform:uppercase}
.passive-panel.compact .slot-refund{font-size:11px;padding:6px 10px;letter-spacing:.12em}
.slot-empty{
  font-size:12px;
  color:#627082;
  letter-spacing:.15em;
  text-transform:uppercase;
  margin-top:auto;
  margin-bottom:auto;
  text-align:center;
}
@media (max-width:1480px){.hud-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
@media (max-width:1100px){
  .hud{
    display:flex;
    flex-direction:column;
    align-items:stretch;
    gap:14px;
    padding:6px 10px;
  }
  .hud-grid{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .hud-controls,
  .hud-abilities,
  .hud-towers{
    flex-wrap:wrap;
    justify-content:center;
  }
  .tower-palette{
    flex-wrap:wrap;
    justify-content:center;
  }
  .currency-box{
    max-width:600px;
    margin:0 auto;
  }
  .currency-rail{grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
  .hud-controls button,
  .hud-abilities .abil-btn,
  .tower-btn{
    font-size:12px;
    padding:6px 10px;
  }
}
@media (max-width:1280px){.wave-panel,.passive-panel{flex:0 0 220px}}
@media (max-width:860px){
  .wave-panel,
  .passive-panel{
    max-height:unset;
    width:100%;
    padding:10px;
    flex:1 1 auto;
    align-items:stretch;
  }
  .wave-panel{
    align-items:flex-start;
  }
  #canvas-shell{order:2}
  .wave-panel{order:1}
  .passive-panel{order:3}
  .tower-palette,
  .hud-controls .control-row,
  .hud-abilities{
    flex-wrap:wrap;
    justify-content:center;
    gap:6px;
  }
  .tower-btn,
  .abil-btn{
    flex:1 1 30%;
    min-width:90px;
    text-align:center;
    min-height:32px;
    max-height:32px;
    line-height:1.1;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .hud-controls .control-row button,
  .hud-abilities .abil-btn{justify-content:center}
  .wave-panel-top{
    width:100%;
    align-items:center;
    gap:8px;
  }
  .wave-panel-top #wave-status{
    max-width:100%;
  }
  .passive-panel .passive-slot-grid{grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
}
@media (max-width:1100px){
  .wave-panel{
    align-items:flex-start;
  }
  .wave-panel-top{
    align-items:flex-start;
    width:100%;
  }
  .wave-panel-top #wave-status{
    width:auto;
    max-width:280px;
    align-self:flex-start;
  }
  .wave-panel-top #stat-wave{
    width:auto;
    text-align:left;
  }
  .wave-metrics{
    width:auto;
    max-width:360px;
  }
  .wave-metric{width:100%;}
  .banner-feed{
    max-width:360px;
    width:100%;
  }
  #combat-stats{
    left:8px;
    right:auto;
    width:clamp(160px, 40vw, 220px);
  }
}
@media (max-width:720px){
  .hud-title h1{text-align:center}
  .hud-cell{flex-direction:column;align-items:flex-start}
  .hud-controls button,.hud-abilities .abil-btn{width:100%}
  .hud-towers .tower-palette{flex-wrap:wrap}
}
@media (max-width:860px){
  .hud{
    grid-template-columns:1fr;
    grid-auto-rows:max-content;
    padding:6px 8px;
    gap:6px;
  }
  .stage-wrap{
    --side-panel-width: clamp(120px, 28vw, 180px);
    display:grid;
    grid-template-columns:var(--side-panel-width) minmax(300px,1fr) var(--side-panel-width);
    padding:6px;
    gap:6px;
  }
	  #canvas-shell canvas{
	    min-width:300px;
	  }
	}
@media screen and (max-width: 900px) and (orientation: landscape){
  body{overflow-x:hidden;}
}
